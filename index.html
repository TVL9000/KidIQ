<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>IQ Trainer</title>

<style>
body { margin:0; font-family:-apple-system,system-ui; background:#0b1220; color:#eaf2ff }
.wrap { padding:16px; display:grid; gap:12px }
.card { background:rgba(255,255,255,.08); border-radius:16px; padding:14px }
.row { display:flex; gap:8px; flex-wrap:wrap }
.pill { background:rgba(255,255,255,.15); padding:6px 10px; border-radius:999px; font-size:12px }
button { width:100%; padding:12px; border-radius:14px; border:0; font-weight:700 }
.primary { background:#4aa3ff; color:#06101f }
.secondary { background:rgba(255,255,255,.15); color:#fff }
.hidden { display:none }
.grid2 { display:grid; grid-template-columns:repeat(2,1fr); gap:8px }
.grid3 { display:grid; grid-template-columns:repeat(3,1fr); gap:8px }
.barOuter { height:8px; background:rgba(255,255,255,.15); border-radius:999px }
.barInner { height:100%; background:#78ff9c }
.big { font-size:32px; text-align:center; font-weight:900 }
.msg { font-weight:700; text-align:center }
.center { text-align:center }
</style>
</head>

<body>
<div class="wrap">

<div class="card" id="homeCard">
  <h2>ğŸ§  IQ Trainer</h2>
  <button class="primary" id="startBtn">Start Session</button>
</div>

<div class="card hidden" id="gameCard">
  <div class="row">
    <div class="pill" id="gameName"></div>
    <div class="pill" id="roundPill"></div>
    <div class="pill" id="difficultyPill"></div>
  </div>
  <div style="height:10px"></div>
  <div id="gameArea"></div>
</div>

<div class="wrap hidden" id="summaryView"></div>

</div>

<script>
/* STORAGE */
const store={get:(k,d)=>JSON.parse(localStorage.getItem(k))??d,set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))};
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const getDiff=g=>store.get("diff_"+g,1);
const setDiff=(g,l)=>store.set("diff_"+g,l);

/* GAME META */
const games=["pattern","math","memory","color","odd","speed"];
const meta={
pattern:{icon:"ğŸ§©",name:"Pattern Match"},
math:{icon:"ğŸ”¢",name:"Quick Math"},
memory:{icon:"ğŸ§ ",name:"Memory Flash"},
color:{icon:"ğŸŸ¦",name:"Color Grid"},
odd:{icon:"â“",name:"Odd One Out"},
speed:{icon:"âš¡",name:"Speed Tap"}
};

/* SESSION ENGINE */
const Engine={
cycle:1,cycles:3,gi:0,ri:0,rounds:[],results:{},
start(){
this.cycle=1;this.gi=0;this.ri=0;this.rounds=[];this.results={};
games.forEach(g=>this.results[g]={start:getDiff(g),scores:[],end:getDiff(g)});
homeCard.classList.add("hidden");gameCard.classList.remove("hidden");
this.startRound();
},
startRound(){
const g=games[this.gi];
gameName.textContent=meta[g].icon+" "+meta[g].name;
roundPill.textContent=`Round ${this.ri+1}/3 â€¢ Cycle ${this.cycle}/3`;
difficultyPill.textContent=`Level ${getDiff(g)}`;
Game.render(g,getDiff(g));
},
record(score){
this.rounds.push(score);this.ri++;
this.ri===3?this.finishBlock():this.startRound();
},
finishBlock(){
const g=games[this.gi];
const avg=this.rounds.reduce((a,b)=>a+b,0)/3;
this.results[g].scores.push(Math.round(avg));
let l=getDiff(g);
if(avg>=80)l++;else if(avg<=40)l--;
l=clamp(l,1,4);setDiff(g,l);this.results[g].end=l;
this.rounds=[];this.ri=0;this.gi++;
this.gi===games.length?this.finishCycle():this.startRound();
},
finishCycle(){
this.gi=0;
this.cycle<this.cycles?(this.cycle++,this.startRound()):this.finishSession();
},
finishSession(){
gameCard.classList.add("hidden");renderSummary(this.results);
}
};

/* GAME ROUTER */
const Game={render(t,l){
({pattern,math,memory,color,odd,speed}[t])(l);
}};

/* GAME IMPLEMENTATIONS */

/* Pattern Match */
function pattern(l){
const shapes=["â–²","â– ","â—","â—†"];
const a=shapes[Math.floor(Math.random()*shapes.length)];
const b=shapes.find(x=>x!==a);
const ans=l>1?b:a;
const opts=[a,b].sort(()=>Math.random()-.5);
gameArea.innerHTML=`<div class="big">${a} â†’ ?</div><div class="grid2">${opts.map(o=>`<button class="secondary">${o}</button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach(b=>b.onclick=()=>Engine.record(b.textContent===ans?100:0));
}

/* Quick Math */
function math(l){
const a=Math.floor(Math.random()*20)+1,b=Math.floor(Math.random()*20)+1;
const ans=a+b;
const opts=[ans,ans+1,ans-1].sort(()=>Math.random()-.5);
gameArea.innerHTML=`<div class="big">${a}+${b}</div><div class="grid3">${opts.map(o=>`<button class="secondary">${o}</button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach(b=>b.onclick=()=>Engine.record(+b.textContent===ans?100:0));
}

/* Memory Flash */
function memory(l){
const emojis=["ğŸ¶","ğŸ±","ğŸ¦Š","ğŸ¼","ğŸ¦"];
const len=1+l;
const seq=[...Array(len)].map(()=>emojis[Math.floor(Math.random()*emojis.length)]);
gameArea.innerHTML=`<div class="big">${seq.join(" ")}</div><button class="primary">Ready</button>`;
gameArea.querySelector("button").onclick=()=>{
const ans=seq[Math.floor(Math.random()*seq.length)];
const opts=[ans,...emojis.filter(e=>e!==ans)].slice(0,4).sort(()=>Math.random()-.5);
gameArea.innerHTML=`<div class="msg">Which was shown?</div><div class="grid2">${opts.map(o=>`<button class="secondary">${o}</button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach(b=>b.onclick=()=>Engine.record(b.textContent===ans?100:0));
};
}

/* Color Grid */
function color(l){
const size=2+l;
const tiles=l+2;
const cells=[...Array(size*size)].map((_,i)=>i);
cells.sort(()=>Math.random()-.5);
const targets=cells.slice(0,tiles);
gameArea.innerHTML=`<div class="grid3">${cells.map(i=>`<div class="card center" style="height:40px;background:${targets.includes(i)?"#4aa3ff":"rgba(255,255,255,.1)"}"></div>`).join("")}</div>`;
setTimeout(()=>{
let chosen=[];
gameArea.innerHTML=`<div class="grid3">${cells.map(i=>`<button class="secondary" style="height:40px"></button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach((b,i)=>b.onclick=()=>{
chosen.push(i);b.style.background="#4aa3ff";
if(chosen.length===targets.length){
Engine.record(chosen.every(x=>targets.includes(x))?100:0);
}
});
},1200);
}

/* Odd One Out */
function odd(l){
const sets=[["ğŸ","ğŸŒ","ğŸ“","ğŸš—"],["ğŸ¶","ğŸ±","ğŸ­","ğŸ•"]];
const pack=sets[Math.floor(Math.random()*sets.length)];
const odd=pack.find(e=>!/[ğŸğŸŒğŸ“ğŸ¶ğŸ±ğŸ­]/.test(e));
gameArea.innerHTML=`<div class="grid2">${pack.sort(()=>Math.random()-.5).map(o=>`<button class="secondary">${o}</button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach(b=>b.onclick=()=>Engine.record(b.textContent===odd?100:0));
}

/* Speed Tap */
function speed(l){
const syms=["ğŸŸ¥","ğŸŸ¦","ğŸŸ©","ğŸŸ¨"];
const t=syms[Math.floor(Math.random()*syms.length)];
gameArea.innerHTML=`<div class="msg">Tap ${t}</div><div class="grid2">${syms.sort(()=>Math.random()-.5).map(o=>`<button class="secondary">${o}</button>`).join("")}</div>`;
[...gameArea.querySelectorAll("button")].forEach(b=>b.onclick=()=>Engine.record(b.textContent===t?100:0));
}

/* SUMMARY */
function renderSummary(r){
const v=summaryView;v.innerHTML="";v.classList.remove("hidden");
v.innerHTML+=`<div class="card"><h2>â­ Session Complete</h2></div>`;
Object.keys(r).forEach(g=>{
v.innerHTML+=`<div class="card"><div class="row"><div class="pill">${meta[g].icon} ${meta[g].name}</div><div class="pill">${r[g].start} â†’ ${r[g].end}</div></div><div class="grid3">${r[g].scores.map(s=>`<div class="barOuter"><div class="barInner" style="width:${s}%"></div></div>`).join("")}</div></div>`;
});
v.innerHTML+=`<div class="card"><button class="primary" onclick="location.reload()">New Session</button></div>`;
}

/* START */
startBtn.onclick=()=>Engine.start();
</script>
</body>
</html>
